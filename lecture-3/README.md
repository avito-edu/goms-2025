# Conspectus: Работа с файлами, маршалинг и ошибки в Go
---

## **1. Чтение и запись файлов**
### **Открытие файлов**
- **`os.Open(path)`** – только для чтения.
- **`os.Create(path)`** – создает или перезаписывает файл.
- **`os.OpenFile(path, flag, perm)`** – гибкое открытие с указанием режима (например, `os.O_RDWR|os.O_APPEND`).

### **Режимы открытия**
- `os.O_RDONLY` – только чтение.
- `os.O_WRONLY` – только запись.
- `os.O_RDWR` – чтение и запись.
- `os.O_APPEND` – дозапись в конец.
- `os.O_CREATE` – создать, если не существует.
- `os.O_TRUNC` – очистить файл при открытии.

### **Закрытие файлов**
- **`file.Close()`** освобождает дескриптор файла (важно делать через `defer`).
- **Почему важно**:
    - Дескрипторы – ограниченный ресурс ОС (лимит на процесс).
    - Не закрытый файл может привести к утечке памяти/ресурсов.
    - На уровне ОС: дескриптор возвращается в пул, блокировки снимаются.

---

## **2. Маршалинг и анмаршалинг**
### **Что это**
- **Маршалинг** – преобразование структуры данных (например, структуры Go) в формат (JSON, XML).
- **Анмаршалинг** – обратный процесс (JSON → структура).

### **Зачем использовать**
- Сериализация данных для передачи/хранения.
- Работа с API (например, JSON-RPC).

### **JSON в Go**
```go
type User struct {
    Name string `json:"name"`  // Тег для имени поля в JSON
    Age  int    `json:"age"`  
}  

// Маршалинг
data, _ := json.Marshal(user)  

// Анмаршалинг
var user User
json.Unmarshal(data, &user)  
```

---

## **3. Ошибки в Go**
### **Ошибки как значения**
- Ошибки – это обычные значения, реализующие интерфейс `error`.
- **Проверка**:
  ```go
  if err != nil {
      return fmt.Errorf("описание: %w", err)  // Обертывание ошибки
  }  
  ```  

### **Свои типы ошибок**
```go
type MyError struct {  
    Code    int  
    Message string  
}  

func (e *MyError) Error() string {  
    return fmt.Sprintf("code=%d, msg=%s", e.Code, e.Message)  
}  
```  

### **Panic и Recover**
- **`panic(msg)`** – аварийная остановка программы.
- **`recover()`** – ловит панику (только внутри `defer`).
  ```go
  defer func() {  
      if r := recover(); r != nil {  
          log.Println("Recovered:", r)  
      }  
  }()  
  ```  

**Итог**:
- Файлы: открывать → использовать → закрывать (`defer`).
- JSON: теги структур + `Marshal`/`Unmarshal`.
- Ошибки: проверять, оборачивать (`%w`), создавать кастомные типы.
- Паника – только для критических ошибок, в остальных случаях – `error`.